{% extends '_layout.njk' %}

{% from "govuk/components/breadcrumbs/macro.njk" import govukBreadcrumbs %}
{% from "govuk/components/button/macro.njk" import govukButton %}

{% set title = "Manual payment upload" %}

{% block content %}
  {{ govukBreadcrumbs({
    items: [{
      text: "Home",
      href: "/"
    },{
      text: title,
      href: "/manual-payments"
    }]
  }) }}

{% set pdfDownloadLink = '/report-list/status-report/download?file-name=' ~ 'reports/DS1-Manual payment upload - service design.pdf' | urlencode %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
      
    <h1 class="govuk-heading-l">{{ title }}</h1>

    <p class="govuk-body">
      This section allows teams to upload manual payment files into Payment Hub. Once uploaded, these files will automatically feed into the standard payment process. Access to this section is controlled by role-based access groups and should only be used by the relevant pay teams. You can find full details of the service design for manual payments in the 
      <a class="govuk-link" href="{{ pdfDownloadLink }}" target="_blank" rel="noopener noreferrer">
        Manual Payments Guidance (PDF)
      </a>.
    </p>

    {% if errors %}
      <div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="govuk-error-summary">
        <h2 class="govuk-error-summary__title" id="error-summary-title">
          There is a problem
        </h2>
        <div class="govuk-error-summary__body">
          <ul class="govuk-list govuk-error-summary__list">
            {% for errorDetail in errors.details %}
              <li>
                <span class="govuk-error-message"><span class="govuk-visually-hidden">Error:</span> {{ errorDetail.message }}</span>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    {% endif %}

    <form method="POST" action="/manual-payments/upload" autocomplete="off" novalidate enctype="multipart/form-data">
      <input type="hidden" name="crumb" value="{{ crumb }}"/>

      <div class="govuk-form-group">
        <label class="govuk-label govuk-label-s" for="file">
          Upload a file
        </label>
        <div class="govuk-hint">
          The file must be in CSV format and include valid manual payment data.
        </div>
        <input class="govuk-file-upload" id="file" name="file" type="file" value="{{ file }}">
      </div>

      {{ govukButton({
        text: "Upload",
        attributes: {
          id: "submit"
        }
      }) }}
    </form>

    <div class="govuk-grid-row govuk-!-margin-top-6">
      <div class="govuk-grid-column-full">
        <h2 class="govuk-heading-m">Upload history</h2>
        {% if uploadHistory and uploadHistory.length > 0 %}
          <table class="govuk-table govuk-!-margin-bottom-0">
            <thead class="govuk-table__head">
              <tr class="govuk-table__row">
                <th class="govuk-table__header">Date uploaded</th>
                <th class="govuk-table__header">Filename</th>
                <th class="govuk-table__header">Name</th>
                <th class="govuk-table__header">Payment status</th>
              </tr>
            </thead>
            <tbody class="govuk-table__body">
              {% for upload in uploadHistory %}
                <tr class="govuk-table__row">
                  <td class="govuk-table__cell">{{ upload.timeStamp }}</td>
                  <td class="govuk-table__cell">{{ upload.filename }}</td>
                  <td class="govuk-table__cell">{{ upload.uploader }}</td>
                  <td class="govuk-table__cell"><a href="/monitoring/batch/name?batch={{ upload.filename }}" class="govuk-link">View payment status</a></td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <div class="govuk-inset-text">
            There are no uploads to show yet. 
            You can upload a file using the form above.
          </div>
        {% endif %}
      </div>
    </div>


  </div>
</div>
{% endblock %}
